<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>جلسه دوازدهم: پروژه نهایی و استقرار مدل‌های علم داده</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;700;900&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Vazirmatn', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            background: rgba(255,255,255,0.1);
            padding: 30px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            font-weight: 900;
        }

        .header p {
            font-size: 1.3em;
            opacity: 0.9;
            font-weight: 300;
        }

        .slides-container {
            position: relative;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            overflow: hidden;
            min-height: 800px;
        }

        .slide {
            display: none;
            padding: 50px;
            min-height: 800px;
            position: relative;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }

        .slide.active {
            display: block;
            animation: slideIn 0.5s ease-in-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(50px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .slide-number {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #4CAF50;
            color: white;
            padding: 10px 15px;
            border-radius: 25px;
            font-weight: bold;
            font-size: 0.9em;
        }

        .expand-btn, .close-btn {
            position: absolute;
            top: 20px;
            background: #2196F3;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            z-index: 100;
        }

        .expand-btn {
            left: 20px;
        }

        .close-btn {
            left: 70px;
            background: #f44336;
            display: none;
        }

        .expand-btn:hover, .close-btn:hover {
            transform: scale(1.1);
        }

        .slide.expanded {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 1000;
            padding: 80px 50px 50px;
            overflow-y: auto;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }

        .slide.expanded .close-btn {
            display: block;
        }

        .icon {
            font-size: 4em;
            text-align: center;
            margin-bottom: 20px;
        }

        .slide-title {
            font-size: 2.5em;
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            font-weight: 700;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        .slide-content {
            font-size: 1.1em;
            color: #444;
            max-width: 1200px;
            margin: 0 auto;
        }

        .slide-content h3 {
            color: #2980b9;
            margin: 30px 0 20px 0;
            font-size: 1.5em;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
            font-weight: 600;
        }

        .code-block {
            background: #1e1e1e;
            color: #f8f8f2;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            position: relative;
            border-left: 5px solid #4CAF50;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .code-block .copy-btn {
            position: absolute;
            top: 10px;
            left: 10px;
            background: #4CAF50;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8em;
        }

        .code-block .copy-btn:hover {
            background: #45a049;
        }

        .keyword { color: #66d9ef; font-weight: bold; }
        .string { color: #a6e22e; }
        .comment { color: #75715e; font-style: italic; }
        .number { color: #ae81ff; }
        .function { color: #f92672; font-weight: bold; }

        .project-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 20px;
            margin: 20px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transform: perspective(1000px) rotateX(5deg);
            transition: all 0.3s ease;
        }

        .project-card:hover {
            transform: perspective(1000px) rotateX(0deg) scale(1.02);
        }

        .project-title {
            font-size: 1.8em;
            font-weight: 700;
            margin-bottom: 15px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        .project-desc {
            font-size: 1.1em;
            line-height: 1.6;
            opacity: 0.95;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .feature-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-left: 5px solid;
            transition: all 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .feature-card.ml { border-left-color: #e74c3c; }
        .feature-card.deployment { border-left-color: #2ecc71; }
        .feature-card.monitoring { border-left-color: #f39c12; }
        .feature-card.optimization { border-left-color: #9b59b6; }

        .feature-card h4 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3em;
            font-weight: 600;
        }

        .tech-stack {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
        }

        .tech-badge {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 500;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }

        .tech-badge:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .tech-badge.framework { background: linear-gradient(45deg, #3498db, #2980b9); }
        .tech-badge.cloud { background: linear-gradient(45deg, #e74c3c, #c0392b); }
        .tech-badge.monitoring { background: linear-gradient(45deg, #f39c12, #d68910); }

        .architecture-diagram {
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: center;
        }

        .diagram-box {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 25px;
            margin: 10px;
            border-radius: 10px;
            font-weight: 600;
            min-width: 120px;
        }

        .arrow {
            font-size: 2em;
            color: #3498db;
            margin: 0 10px;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .metric-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            border-top: 4px solid #3498db;
        }

        .metric-value {
            font-size: 2em;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .metric-label {
            color: #7f8c8d;
            font-size: 0.9em;
        }

        .challenge-box {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .challenge-title {
            font-size: 1.5em;
            font-weight: 700;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tip-box {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .tip-title {
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
            padding: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .nav-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }

        .slide-info {
            color: white;
            font-size: 1.2em;
            font-weight: 600;
        }

        .slide-list {
            background: rgba(255,255,255,0.1);
            padding: 25px;
            border-radius: 15px;
            margin-top: 20px;
            backdrop-filter: blur(10px);
        }

        .slide-list h3 {
            color: white;
            margin-bottom: 20px;
            font-size: 1.5em;
            text-align: center;
        }

        .slide-links {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 10px;
        }

        .slide-links a {
            color: white;
            text-decoration: none;
            padding: 12px 15px;
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            transition: all 0.3s ease;
            border-right: 4px solid transparent;
        }

        .slide-links a:hover {
            background: rgba(255,255,255,0.2);
            border-right-color: #4CAF50;
            transform: translateX(-5px);
        }

        .deployment-flow {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin: 20px 0;
        }

        .flow-step {
            display: flex;
            align-items: center;
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .flow-step:hover {
            transform: translateX(10px);
        }

        .step-number {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-left: 20px;
            flex-shrink: 0;
        }

        .step-content {
            flex: 1;
        }

        .step-title {
            font-size: 1.2em;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .step-desc {
            color: #7f8c8d;
        }

        .model-comparison {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .model-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            border-top: 5px solid;
        }

        .model-card:nth-child(1) { border-top-color: #e74c3c; }
        .model-card:nth-child(2) { border-top-color: #2ecc71; }
        .model-card:nth-child(3) { border-top-color: #f39c12; }
        .model-card:nth-child(4) { border-top-color: #9b59b6; }

        .model-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
        }

        .model-name {
            font-size: 1.3em;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .model-accuracy {
            font-size: 2em;
            font-weight: 700;
            color: #27ae60;
            margin-bottom: 10px;
        }

        .model-desc {
            color: #7f8c8d;
            font-size: 0.95em;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .slide {
                padding: 20px;
            }
            
            .slide-title {
                font-size: 1.8em;
            }
            
            .feature-grid {
                grid-template-columns: 1fr;
            }
            
            .navigation {
                flex-direction: column;
                gap: 15px;
            }
            
            .slide-links {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- هدر -->
        <div class="header">
            <h1>🚀 جلسه دوازدهم</h1>
            <p>پروژه نهایی و استقرار مدل‌های علم داده در محیط تولید</p>
        </div>

        <!-- کانتینر اسلایدها -->
        <div class="slides-container">
            <!-- اسلاید 1: معرفی جلسه نهایی -->
            <div class="slide active" id="slide1">
                <div class="slide-number">1/15</div>
                <button class="expand-btn" onclick="expandSlide(this)">🔍</button>
                <button class="close-btn" onclick="closeSlide(this)">×</button>
                <div class="icon">🎯</div>
                <div class="slide-title">جلسه نهایی: از ایده تا تولید</div>
                <div class="slide-content">
                    <div class="project-card">
                        <div class="project-title">🚀 پروژه نهایی جامع علم داده</div>
                        <div class="project-desc">
                            در این جلسه نهایی، یک سیستم کامل علم داده ایجاد می‌کنیم که شامل 
                            جمع‌آوری داده، پردازش، مدل‌سازی، استقرار و مونیتورینگ است. 
                            این پروژه تمام مفاهیم آموخته شده در 11 جلسه قبل را ترکیب می‌کند.
                        </div>
                    </div>

                    <h3>🎯 اهداف جلسه دوازدهم</h3>
                    <div class="feature-grid">
                        <div class="feature-card ml">
                            <h4>🤖 پروژه ML کامل</h4>
                            <p>ساخت سیستم پیش‌بینی قیمت مسکن با تمام مراحل از داده خام تا مدل نهایی</p>
                        </div>
                        <div class="feature-card deployment">
                            <h4>🌐 استقرار مدل</h4>
                            <p>استقرار مدل در محیط تولید با Flask API، Docker و Cloud Services</p>
                        </div>
                        <div class="feature-card monitoring">
                            <h4>📊 مونیتورینگ</h4>
                            <p>نظارت بر عملکرد مدل، تشخیص Data Drift و بروزرسانی خودکار</p>
                        </div>
                        <div class="feature-card optimization">
                            <h4>⚡ بهینه‌سازی</h4>
                            <p>بهینه‌سازی سرعت، دقت و منابع برای استفاده در مقیاس بزرگ</p>
                        </div>
                    </div>

                    <h3>📋 دستور کار جلسه</h3>
                    <div class="deployment-flow">
                        <div class="flow-step">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <div class="step-title">جمع‌آوری و پردازش داده</div>
                                <div class="step-desc">دریافت داده املاک از منابع مختلف و پاکسازی</div>
                            </div>
                        </div>
                        <div class="flow-step">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <div class="step-title">مهندسی ویژگی</div>
                                <div class="step-desc">استخراج ویژگی‌های مهم و تبدیل داده‌ها</div>
                            </div>
                        </div>
                        <div class="flow-step">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <div class="step-title">مدل‌سازی پیشرفته</div>
                                <div class="step-desc">آموزش مدل‌های مختلف و انتخاب بهترین</div>
                            </div>
                        </div>
                        <div class="flow-step">
                            <div class="step-number">4</div>
                            <div class="step-content">
                                <div class="step-title">ایجاد API و وب سرویس</div>
                                <div class="step-desc">ساخت REST API با Flask و FastAPI</div>
                            </div>
                        </div>
                        <div class="flow-step">
                            <div class="step-number">5</div>
                            <div class="step-content">
                                <div class="step-title">استقرار و مونیتورینگ</div>
                                <div class="step-desc">Deploy روی Cloud و نظارت مستمر</div>
                            </div>
                        </div>
                    </div>

                    <h3>🛠️ ابزارهای مورد استفاده</h3>
                    <div class="tech-stack">
                        <span class="tech-badge">Python</span>
                        <span class="tech-badge">Pandas</span>
                        <span class="tech-badge">Scikit-learn</span>
                        <span class="tech-badge">XGBoost</span>
                        <span class="tech-badge framework">Flask</span>
                        <span class="tech-badge framework">FastAPI</span>
                        <span class="tech-badge cloud">Docker</span>
                        <span class="tech-badge cloud">AWS/GCP</span>
                        <span class="tech-badge monitoring">MLflow</span>
                        <span class="tech-badge monitoring">Streamlit</span>
                        <span class="tech-badge">PostgreSQL</span>
                        <span class="tech-badge">Redis</span>
                    </div>

                    <h3>📊 معیارهای موفقیت پروژه</h3>
                    <div class="metrics-grid">
                        <div class="metric-card">
                            <div class="metric-value">95%+</div>
                            <div class="metric-label">دقت مدل</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">&lt;100ms</div>
                            <div class="metric-label">زمان پاسخ API</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">99.9%</div>
                            <div class="metric-label">Uptime سرویس</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">1000+</div>
                            <div class="metric-label">درخواست/ثانیه</div>
                        </div>
                    </div>

                    <div class="tip-box">
                        <div class="tip-title">🎯 هدف جلسه نهایی</div>
                        <p>
                            در پایان این جلسه، شما قادر خواهید بود یک پروژه کامل علم داده را از صفر تا صد پیاده‌سازی کنید، 
                            از جمع‌آوری داده تا استقرار در محیط تولید و مونیتورینگ مستمر. این پروژه نمونه‌ای کامل 
                            برای portfolio شما خواهد بود.
                        </p>
                    </div>
                </div>
            </div>

            <!-- اسلاید 2: جمع‌آوری و پردازش داده -->
            <div class="slide" id="slide2">
                <div class="slide-number">2/15</div>
                <button class="expand-btn" onclick="expandSlide(this)">🔍</button>
                <button class="close-btn" onclick="closeSlide(this)">×</button>
                <div class="icon">📊</div>
                <div class="slide-title">مرحله اول: جمع‌آوری و پردازش داده</div>
                <div class="slide-content">
                    <div class="project-card">
                        <div class="project-title">🏠 پروژه پیش‌بینی قیمت مسکن</div>
                        <div class="project-desc">
                            سیستم هوشمند پیش‌بینی قیمت املاک با استفاده از داده‌های جغرافیایی، 
                            ویژگی‌های ساختمان، قیمت‌های تاریخی و عوامل اقتصادی
                        </div>
                    </div>

                    <h3>📚 مرحله 1: ایجاد دیتاست جامع</h3>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">کپی</button>
<span class="comment"># پروژه نهایی: سیستم پیش‌بینی قیمت مسکن</span>
<span class="keyword">import</span> pandas <span class="keyword">as</span> pd
<span class="keyword">import</span> numpy <span class="keyword">as</span> np
<span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt
<span class="keyword">import</span> seaborn <span class="keyword">as</span> sns
<span class="keyword">import</span> warnings
<span class="keyword">from</span> datetime <span class="keyword">import</span> datetime, timedelta
<span class="keyword">import</span> random
<span class="keyword">from</span> faker <span class="keyword">import</span> Faker

warnings.filterwarnings(<span class="string">'ignore'</span>)
plt.rcParams[<span class="string">'font.family'</span>] = [<span class="string">'Tahoma'</span>]

<span class="comment"># تنظیمات اولیه</span>
fake = Faker(<span class="string">'fa_IR'</span>)  <span class="comment"># فارسی</span>
np.random.seed(<span class="number">42</span>)
random.seed(<span class="number">42</span>)

<span class="function">print</span>(<span class="string">"🏠 پروژه نهایی: سیستم پیش‌بینی قیمت مسکن"</span>)
<span class="function">print</span>(<span class="string">"="</span> * <span class="number">60</span>)

<span class="comment"># تعریف مناطق تهران و ضرایب قیمت</span>
tehran_districts = {
    <span class="string">'منطقه 1'</span>: {<span class="string">'base_price'</span>: <span class="number">180</span>, <span class="string">'coords'</span>: (<span class="number">35.7219</span>, <span class="number">51.3347</span>)},
    <span class="string">'منطقه 2'</span>: {<span class="string">'base_price'</span>: <span class="number">160</span>, <span class="string">'coords'</span>: (<span class="number">35.7589</span>, <span class="number">51.4087</span>)},
    <span class="string">'منطقه 3'</span>: {<span class="string">'base_price'</span>: <span class="number">140</span>, <span class="string">'coords'</span>: (<span class="number">35.7661</span>, <span class="number">51.4606</span>)},
    <span class="string">'منطقه 4'</span>: {<span class="string">'base_price'</span>: <span class="number">135</span>, <span class="string">'coords'</span>: (<span class="number">35.7261</span>, <span class="number">51.4786</span>)},
    <span class="string">'منطقه 5'</span>: {<span class="string">'base_price'</span>: <span class="number">125</span>, <span class="string">'coords'</span>: (<span class="number">35.6991</span>, <span class="number">51.4478</span>)},
    <span class="string">'منطقه 6'</span>: {<span class="string">'base_price'</span>: <span class="number">110</span>, <span class="string">'coords'</span>: (<span class="number">35.6781</span>, <span class="number">51.3889</span>)},
    <span class="string">'منطقه 7'</span>: {<span class="string">'base_price'</span>: <span class="number">105</span>, <span class="string">'coords'</span>: (<span class="number">35.6561</span>, <span class="number">51.4258</span>)},
    <span class="string">'منطقه 8'</span>: {<span class="string">'base_price'</span>: <span class="number">95</span>, <span class="string">'coords'</span>: (<span class="number">35.6422</span>, <span class="number">51.4739</span>)},
    <span class="string">'منطقه 9'</span>: {<span class="string">'base_price'</span>: <span class="number">85</span>, <span class="string">'coords'</span>: (<span class="number">35.6822</span>, <span class="string">'51.3158</span>)},
    <span class="string">'منطقه 10'</span>: {<span class="string">'base_price'</span>: <span class="number">90</span>, <span class="string">'coords'</span>: (<span class="number">35.6542</span>, <span class="number">51.3469</span>)}
}

<span class="comment"># تولید داده‌های املاک</span>
<span class="function">print</span>(<span class="string">"📊 تولید دیتاست املاک..."</span>)

<span class="keyword">def</span> <span class="function">generate_real_estate_data</span>(n_samples=<span class="number">5000</span>):
    <span class="string">"""تولید داده‌های واقعی املاک"""</span>
    data = []
    
    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="function">range</span>(n_samples):
        <span class="comment"># انتخاب منطقه</span>
        district = np.random.choice(<span class="function">list</span>(tehran_districts.keys()))
        district_info = tehran_districts[district]
        base_price = district_info[<span class="string">'base_price'</span>]
        lat, lng = district_info[<span class="string">'coords'</span>]
        
        <span class="comment"># ویژگی‌های ملک</span>
        area = np.random.normal(<span class="number">85</span>, <span class="number">25</span>)  <span class="comment"># متراژ</span>
        area = <span class="function">max</span>(<span class="number">40</span>, <span class="function">min</span>(<span class="number">300</span>, area))  <span class="comment"># محدودیت</span>
        
        rooms = np.random.choice([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>], 
                               p=[<span class="number">0.1</span>, <span class="number">0.25</span>, <span class="number">0.4</span>, <span class="number">0.2</span>, <span class="number">0.05</span>])
        
        age = np.random.exponential(<span class="number">8</span>)  <span class="comment"># سن ساختمان</span>
        age = <span class="function">min</span>(<span class="number">50</span>, age)
        
        floor = np.random.randint(<span class="number">1</span>, <span class="number">15</span>)
        total_floors = floor + np.random.randint(<span class="number">0</span>, <span class="number">10</span>)
        
        <span class="comment"># ویژگی‌های اضافی</span>
        has_parking = np.random.choice([<span class="number">0</span>, <span class="number">1</span>], p=[<span class="number">0.3</span>, <span class="number">0.7</span>])
        has_warehouse = np.random.choice([<span class="number">0</span>, <span class="number">1</span>], p=[<span class="number">0.6</span>, <span class="number">0.4</span>])
        has_elevator = <span class="number">1</span> <span class="keyword">if</span> total_floors > <span class="number">3</span> <span class="keyword">else</span> np.random.choice([<span class="number">0</span>, <span class="number">1</span>], p=[<span class="number">0.8</span>, <span class="number">0.2</span>])
        
        direction = np.random.choice([<span class="string">'شمالی'</span>, <span class="string">'جنوبی'</span>, <span class="string">'شرقی'</span>, <span class="string">'غربی'</span>, 
                                    <span class="string">'شمال شرقی'</span>, <span class="string">'شمال غربی'</span>, <span class="string">'جنوب شرقی'</span>, <span class="string">'جنوب غربی'</span>])
        
        property_type = np.random.choice([<span class="string">'آپارتمان'</span>, <span class="string">'خانه'</span>, <span class="string">'ویلا'</span>], 
                                       p=[<span class="number">0.8</span>, <span class="number">0.15</span>, <span class="number">0.05</span>])
        
        <span class="comment"># محاسبه فاصله از مرکز شهر</span>
        city_center = (<span class="number">35.6892</span>, <span class="number">51.3890</span>)
        distance_to_center = np.sqrt((lat - city_center[<span class="number">0</span>])**<span class="number">2</span> + (lng - city_center[<span class="number">1</span>])**<span class="number">2</span>) * <span class="number">111</span>  <span class="comment"># km</span>
        
        <span class="comment"># محاسبه قیمت</span>
        price_per_meter = base_price * <span class="number">1000000</span>  <span class="comment"># تومان</span>
        
        <span class="comment"># تأثیر عوامل مختلف</span>
        area_factor = <span class="number">1</span> + (area - <span class="number">80</span>) / <span class="number">1000</span>  <span class="comment"># متراژ بیشتر</span>
        age_factor = <span class="function">max</span>(<span class="number">0.5</span>, <span class="number">1</span> - age / <span class="number">100</span>)  <span class="comment"># سن کمتر</span>
        floor_factor = <span class="number">1</span> + (floor - <span class="number">1</span>) * <span class="number">0.02</span>  <span class="comment"># طبقه بالاتر</span>
        parking_factor = <span class="number">1.15</span> <span class="keyword">if</span> has_parking <span class="keyword">else</span> <span class="number">1</span>
        warehouse_factor = <span class="number">1.08</span> <span class="keyword">if</span> has_warehouse <span class="keyword">else</span> <span class="number">1</span>
        elevator_factor = <span class="number">1.1</span> <span class="keyword">if</span> has_elevator <span class="keyword">else</span> <span class="number">1</span>
        
        <span class="comment"># جهت ساختمان</span>
        direction_factors = {
            <span class="string">'شمالی'</span>: <span class="number">1.1</span>, <span class="string">'جنوبی'</span>: <span class="number">0.95</span>, <span class="string">'شرقی'</span>: <span class="number">1.0</span>, <span class="string">'غربی'</span>: <span class="number">0.98</span>,
            <span class="string">'شمال شرقی'</span>: <span class="number">1.05</span>, <span class="string">'شمال غربی'</span>: <span class="number">1.03</span>, <span class="string">'جنوب شرقی'</span>: <span class="number">0.97</span>, <span class="string">'جنوب غربی'</span>: <span class="number">0.93</span>
        }
        direction_factor = direction_factors[direction]
        
        <span class="comment"># فاصله از مرکز</span>
        distance_factor = <span class="function">max</span>(<span class="number">0.7</span>, <span class="number">1</span> - distance_to_center * <span class="number">0.02</span>)
        
        <span class="comment"># قیمت نهایی</span>
        final_price = (price_per_meter * area * area_factor * age_factor * 
                      floor_factor * parking_factor * warehouse_factor * 
                      elevator_factor * direction_factor * distance_factor)
        
        <span class="comment"># اضافه کردن نویز</span>
        noise = np.random.normal(<span class="number">1</span>, <span class="number">0.1</span>)
        final_price *= noise
        
        <span class="comment"># تاریخ فروش (در سال گذشته)</span>
        sale_date = datetime.now() - timedelta(days=np.random.randint(<span class="number">0</span>, <span class="number">365</span>))
        
        <span class="comment"># اطلاعات اضافی</span>
        metro_distance = np.random.exponential(<span class="number">2</span>)  <span class="comment"># km تا متro</span>
        school_rating = np.random.uniform(<span class="number">2</span>, <span class="number">5</span>)  <span class="comment"># امتیاز مدارس اطراف</span>
        
        record = {
            <span class="string">'id'</span>: i + <span class="number">1</span>,
            <span class="string">'district'</span>: district,
            <span class="string">'area'</span>: <span class="function">round</span>(area),
            <span class="string">'rooms'</span>: rooms,
            <span class="string">'age'</span>: <span class="function">round</span>(age, <span class="number">1</span>),
            <span class="string">'floor'</span>: floor,
            <span class="string">'total_floors'</span>: total_floors,
            <span class="string">'has_parking'</span>: has_parking,
            <span class="string">'has_warehouse'</span>: has_warehouse,
            <span class="string">'has_elevator'</span>: has_elevator,
            <span class="string">'direction'</span>: direction,
            <span class="string">'property_type'</span>: property_type,
            <span class="string">'latitude'</span>: <span class="function">round</span>(lat + np.random.normal(<span class="number">0</span>, <span class="number">0.01</span>), <span class="number">6</span>),
            <span class="string">'longitude'</span>: <span class="function">round</span>(lng + np.random.normal(<span class="number">0</span>, <span class="number">0.01</span>), <span class="number">6</span>),
            <span class="string">'distance_to_center'</span>: <span class="function">round</span>(distance_to_center, <span class="number">2</span>),
            <span class="string">'metro_distance'</span>: <span class="function">round</span>(metro_distance, <span class="number">2</span>),
            <span class="string">'school_rating'</span>: <span class="function">round</span>(school_rating, <span class="number">2</span>),
            <span class="string">'sale_date'</span>: sale_date.strftime(<span class="string">'%Y-%m-%d'</span>),
            <span class="string">'price'</span>: <span class="function">round</span>(final_price / <span class="number">1000000</span>)  <span class="comment"># میلیون تومان</span>
        }
        
        data.append(record)
    
    <span class="keyword">return</span> pd.DataFrame(data)

<span class="comment"># تولید دیتاست</span>
df = generate_real_estate_data(<span class="number">5000</span>)

<span class="function">print</span>(<span class="string">f"✅ دیتاست املاک تولید شد:"</span>)
<span class="function">print</span>(<span class="string">f"تعداد رکورد: {len(df):,}"</span>)
<span class="function">print</span>(<span class="string">f"تعداد ویژگی: {df.shape[1]}"</span>)

<span class="function">print</span>(<span class="string">f"\nنمونه داده‌ها:"</span>)
<span class="function">print</span>(df.head())

<span class="function">print</span>(<span class="string">f"\nآمارهای کلی:"</span>)
<span class="function">print</span>(df.describe())
                    </div>

                    <h3>🧹 مرحله 2: پاکسازی و پیش‌پردازش داده</h3>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">کپی</button>
<span class="comment"># پاکسازی و پیش‌پردازش داده‌ها</span>
<span class="function">print</span>(<span class="string">f"\n🧹 پاکسازی و پیش‌پردازش:"</span>)
<span class="function">print</span>(<span class="string">"="</span> * <span class="number">35</span>)

<span class="comment"># بررسی مقادیر گمشده</span>
<span class="function">print</span>(<span class="string">"📊 بررسی مقادیر گمشده:"</span>)
missing_data = df.isnull().<span class="function">sum</span>()
<span class="function">print</span>(missing_data[missing_data > <span class="number">0</span>])

<span class="comment"># اضافه کردن مقادیر گمشده به صورت واقعی</span>
np.random.seed(<span class="number">42</span>)
missing_indices = np.random.choice(df.index, size=<span class="function">int</span>(<span class="function">len</span>(df) * <span class="number">0.02</span>), replace=<span class="keyword">False</span>)
df.loc[missing_indices[:len(missing_indices)//3], <span class="string">'school_rating'</span>] = np.nan
df.loc[missing_indices[len(missing_indices)//3:2*len(missing_indices)//3], <span class="string">'metro_distance'</span>] = np.nan

<span class="function">print</span>(<span class="string">f"مقادیر گمشده اضافه شد:"</span>)
<span class="function">print</span>(df.isnull().<span class="function">sum</span>()[df.isnull().<span class="function">sum</span>() > <span class="number">0</span>])

<span class="comment"># پر کردن مقادیر گمشده</span>
<span class="function">print</span>(<span class="string">f"\n🔧 پر کردن مقادیر گمشده:"</span>)

<span class="comment"># پر کردن بر اساس میانگین گروه</span>
df[<span class="string">'school_rating'</span>] = df.groupby(<span class="string">'district'</span>)[<span class="string">'school_rating'</span>].transform(
    <span class="keyword">lambda</span> x: x.fillna(x.mean())
)

<span class="comment"># پر کردن فاصله متro بر اساس میانه منطقه</span>
df[<span class="string">'metro_distance'</span>] = df.groupby(<span class="string">'district'</span>)[<span class="string">'metro_distance'</span>].transform(
    <span class="keyword">lambda</span> x: x.fillna(x.median())
)

<span class="function">print</span>(<span class="string">"✅ مقادیر گمشده پر شد"</span>)

<span class="comment"># تشخیص و حذف outliers</span>
<span class="function">print</span>(<span class="string">f"\n🎯 تشخیص outliers:"</span>)

<span class="keyword">def</span> <span class="function">detect_outliers_iqr</span>(df, column):
    <span class="string">"""تشخیص outliers با روش IQR"""</span>
    Q1 = df[column].quantile(<span class="number">0.25</span>)
    Q3 = df[column].quantile(<span class="number">0.75</span>)
    IQR = Q3 - Q1
    lower_bound = Q1 - <span class="number">1.5</span> * IQR
    upper_bound = Q3 + <span class="number">1.5</span> * IQR
    
    outliers = df[(df[column] < lower_bound) | (df[column] > upper_bound)]
    <span class="keyword">return</span> outliers.index

<span class="comment"># تشخیص outliers در قیمت و متراژ</span>
price_outliers = detect_outliers_iqr(df, <span class="string">'price'</span>)
area_outliers = detect_outliers_iqr(df, <span class="string">'area'</span>)

<span class="function">print</span>(<span class="string">f"Outliers قیمت: {len(price_outliers)}"</span>)
<span class="function">print</span>(<span class="string">f"Outliers متراژ: {len(area_outliers)}"</span>)

<span class="comment"># حذف outliers شدید</span>
extreme_outliers = df[(df[<span class="string">'price'</span>] > df[<span class="string">'price'</span>].quantile(<span class="number">0.99</span>)) | 
                     (df[<span class="string">'price'</span>] < df[<span class="string">'price'</span>].quantile(<span class="number">0.01</span>))].index

df_clean = df.drop(extreme_outliers)
<span class="function">print</span>(<span class="string">f"رکوردهای حذف شده: {len(extreme_outliers)}"</span>)
<span class="function">print</span>(<span class="string">f"داده‌های باقی‌مانده: {len(df_clean):,}"</span>)

<span class="comment"># تبدیل تاریخ</span>
<span class="function">print</span>(<span class="string">f"\n📅 پردازش تاریخ:"</span>)
df_clean[<span class="string">'sale_date'</span>] = pd.to_datetime(df_clean[<span class="string">'sale_date'</span>])
df_clean[<span class="string">'sale_month'</span>] = df_clean[<span class="string">'sale_date'</span>].dt.month
df_clean[<span class="string">'sale_season'</span>] = df_clean[<span class="string">'sale_month'</span>].map({
    <span class="number">12</span>: <span class="string">'زمستان'</span>, <span class="number">1</span>: <span class="string">'زمستان'</span>, <span class="number">2</span>: <span class="string">'زمستان'</span>,
    <span class="number">3</span>: <span class="string">'بهار'</span>, <span class="number">4</span>: <span class="string">'بهار'</span>, <span class="number">5</span>: <span class="string">'بهار'</span>,
    <span class="number">6</span>: <span class="string">'تابستان'</span>, <span class="number">7</span>: <span class="string">'تابستان'</span>, <span class="number">8</span>: <span class="string">'تابستان'</span>,
    <span class="number">9</span>: <span class="string">'پاییز'</span>, <span class="number">10</span>: <span class="string">'پاییز'</span>, <span class="number">11</span>: <span class="string">'پاییز'</span>
})

<span class="function">print</span>(<span class="string">"✅ تاریخ پردازش شد"</span>)

<span class="comment"># ایجاد ویژگی‌های جدید</span>
<span class="function">print</span>(<span class="string">f"\n🔨 مهندسی ویژگی:"</span>)

<span class="comment"># قیمت هر متر</span>
df_clean[<span class="string">'price_per_sqm'</span>] = df_clean[<span class="string">'price'</span>] / df_clean[<span class="string">'area'</span>]

<span class="comment"># نسبت طبقه</span>
df_clean[<span class="string">'floor_ratio'</span>] = df_clean[<span class="string">'floor'</span>] / df_clean[<span class="string">'total_floors'</span>]

<span class="comment"># امتیاز موقعیت</span>
df_clean[<span class="string">'location_score'</span>] = (
    (<span class="number">5</span> - df_clean[<span class="string">'distance_to_center'</span>].clip(<span class="number">0</span>, <span class="number">5</span>)) * <span class="number">0.3</span> +
    (<span class="number">5</span> - df_clean[<span class="string">'metro_distance'</span>].clip(<span class="number">0</span>, <span class="number">5</span>)) * <span class="number">0.4</span> +
    df_clean[<span class="string">'school_rating'</span>] * <span class="number">0.3</span>
)

<span class="comment"># امتیاز ساختمان</span>
df_clean[<span class="string">'building_score'</span>] = (
    df_clean[<span class="string">'has_parking'</span>] * <span class="number">2</span> +
    df_clean[<span class="string">'has_warehouse'</span>] * <span class="number">1</span> +
    df_clean[<span class="string">'has_elevator'</span>] * <span class="number">1.5</span> +
    (<span class="number">50</span> - df_clean[<span class="string">'age'</span>].clip(<span class="number">0</span>, <span class="number">50</span>)) / <span class="number">10</span>
)

<span class="comment"># دسته‌بندی سن ساختمان</span>
df_clean[<span class="string">'age_category'</span>] = pd.cut(
    df_clean[<span class="string">'age'</span>], 
    bins=[<span class="number">0</span>, <span class="number">5</span>, <span class="number">15</span>, <span class="number">30</span>, <span class="number">100</span>], 
    labels=[<span class="string">'نوساز'</span>, <span class="string">'جوان'</span>, <span class="string">'میانسال'</span>, <span class="string">'قدیمی'</span>]
)

<span class="comment"># دسته‌بندی متراژ</span>
df_clean[<span class="string">'area_category'</span>] = pd.cut(
    df_clean[<span class="string">'area'</span>], 
    bins=[<span class="number">0</span>, <span class="number">60</span>, <span class="number">90</span>, <span class="number">120</span>, <span class="number">1000</span>], 
    labels=[<span class="string">'کوچک'</span>, <span class="string">'متوسط'</span>, <span class="string">'بزرگ'</span>, <span class="string">'خیلی بزرگ'</span>]
)

<span class="function">print</span>(<span class="string">"✅ ویژگی‌های جدید ایجاد شد"</span>)

<span class="comment"># نمایش آمار نهایی</span>
<span class="function">print</span>(<span class="string">f"\n📊 آمار نهایی داده‌ها:"</span>)
<span class="function">print</span>(<span class="string">f"تعداد رکورد: {len(df_clean):,}"</span>)
<span class="function">print</span>(<span class="string">f"تعداد ویژگی: {df_clean.shape[1]}"</span>)
<span class="function">print</span>(<span class="string">f"میانگین قیمت: {df_clean['price'].mean():,.0f} میلیون تومان"</span>)
<span class="function">print</span>(<span class="string">f"میانگین متراژ: {df_clean['area'].mean():.0f} متر"</span>)
<span class="function">print</span>(<span class="string">f"میانگین قیمت هر متر: {df_clean['price_per_sqm'].mean():,.0f} میلیون تومان"</span>)

<span class="function">print</span>(<span class="string">f"\nتوزیع بر اساس منطقه:"</span>)
<span class="function">print</span>(df_clean[<span class="string">'district'</span>].value_counts())

<span class="function">print</span>(<span class="string">f"\nویژگی‌های جدید ایجاد شده:"</span>)
new_features = [<span class="string">'price_per_sqm'</span>, <span class="string">'floor_ratio'</span>, <span class="string">'location_score'</span>, 
                <span class="string">'building_score'</span>, <span class="string">'age_category'</span>, <span class="string">'area_category'</span>, <span class="string">'sale_season'</span>]
<span class="function">print</span>(new_features)
                    </div>

                    <div class="architecture-diagram">
                        <h4>🏗️ معماری پردازش داده</h4>
                        <div style="display: flex; align-items: center; justify-content: center; flex-wrap: wrap;">
                            <div class="diagram-box">Raw Data</div>
                            <span class="arrow">→</span>
                            <div class="diagram-box">Data Cleaning</div>
                            <span class="arrow">→</span>
                            <div class="diagram-box">Feature Engineering</div>
                            <span class="arrow">→</span>
                            <div class="diagram-box">Ready Dataset</div>
                        </div>
                    </div>

                    <div class="tip-box">
                        <div class="tip-title">💡 نکات مهم پردازش داده</div>
                        <ul>
                            <li><strong>Data Quality:</strong> بررسی کیفیت و صحت داده‌ها</li>
                            <li><strong>Missing Values:</strong> مدیریت هوشمند مقادیر گمشده</li>
                            <li><strong>Outlier Detection:</strong> شناسایی و مدیریت داده‌های پرت</li>
                            <li><strong>Feature Engineering:</strong> ایجاد ویژگی‌های مفید از داده‌های خام</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- اسلاید 3: تحلیل اکتشافی داده -->
            <div class="slide" id="slide3">
                <div class="slide-number">3/15</div>
                <button class="expand-btn" onclick="expandSlide(this)">🔍</button>
                <button class="close-btn" onclick="closeSlide(this)">×</button>
                <div class="icon">📈</div>
                <div class="slide-title">تحلیل اکتشافی داده (EDA)</div>
                <div class="slide-content">
                    <h3>📊 مصورسازی جامع داده‌های املاک</h3>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">کپی</button>
<span class="comment"># تحلیل اکتشافی جامع داده‌ها</span>
<span class="function">print</span>(<span class="string">f"\n📈 تحلیل اکتشافی داده (EDA):"</span>)
<span class="function">print</span>(<span class="string">"="</span> * <span class="number">40</span>)

<span class="comment"># تنظیمات نمودار</span>
plt.style.use(<span class="string">'default'</span>)
sns.set_palette(<span class="string">"husl"</span>)

<span class="comment"># ایجاد dashboard جامع</span>
fig = plt.figure(figsize=(<span class="number">24</span>, <span class="number">20</span>))

<span class="comment"># 1. توزیع قیمت</span>
plt.subplot(<span class="number">4</span>, <span class="number">4</span>, <span class="number">1</span>)
plt.hist(df_clean[<span class="string">'price'</span>], bins=<span class="number">50</span>, alpha=<span class="number">0.7</span>, color=<span class="string">'skyblue'</span>, edgecolor=<span class="string">'black'</span>)
plt.axvline(df_clean[<span class="string">'price'</span>].mean(), color=<span class="string">'red'</span>, linestyle=<span class="string">'--'</span>, 
           label=<span class="string">f'میانگین: {df_clean["price"].mean():,.0f}M'</span>)
plt.title(<span class="string">'توزیع قیمت املاک'</span>, fontweight=<span class="string">'bold'</span>)
plt.xlabel(<span class="string">'قیمت (میلیون تومان)'</span>)
plt.ylabel(<span class="string">'فراوانی'</span>)
plt.legend()
plt.grid(<span class="keyword">True</span>, alpha=<span class="number">0.3</span>)

<span class="comment"># 2. قیمت بر اساس منطقه</span>
plt.subplot(<span class="number">4</span>, <span class="number">4</span>, <span class="number">2</span>)
district_prices = df_clean.groupby(<span class="string">'district'</span>)[<span class="string">'price'</span>].mean().sort_values(ascending=<span class="keyword">False</span>)
bars = plt.bar(<span class="function">range</span>(<span class="function">len</span>(district_prices)), district_prices.values, 
               color=plt.cm.Set3(np.arange(<span class="function">len</span>(district_prices))))
plt.title(<span class="string">'میانگین قیمت به تفکیک منطقه'</span>, fontweight=<span class="string">'bold'</span>)
plt.xticks(<span class="function">range</span>(<span class="function">len</span>(district_prices)), district_prices.index, rotation=<span class="number">45</span>)
plt.ylabel(<span class="string">'میانگین قیمت (میلیون تومان)'</span>)

<span class="comment"># اضافه کردن مقادیر روی میله‌ها</span>
<span class="keyword">for</span> bar, price <span class="keyword">in</span> <span class="function">zip</span>(bars, district_prices.values):
    plt.text(bar.get_x() + bar.get_width()/<span class="number">2</span>, bar.get_height() + <span class="number">50</span>, 
             <span class="string">f'{price:,.0f}'</span>, ha=<span class="string">'center'</span>, va=<span class="string">'bottom'</span>, fontweight=<span class="string">'bold'</span>)

<span class="comment"># 3. رابطه متراژ و قیمت</span>
plt.subplot(<span class="number">4</span>, <span class="number">4</span>, <span class="number">3</span>)
scatter = plt.scatter(df_clean[<span class="string">'area'</span>], df_clean[<span class="string">'price'</span>], 
                     c=df_clean[<span class="string">'rooms'</span>], cmap=<span class="string">'viridis'</span>, alpha=<span class="number">0.6</span>)
plt.colorbar(scatter, label=<span class="string">'تعداد اتاق'</span>)
plt.title(<span class="string">'رابطه متراژ و قیمت'</span>, fontweight=<span class="string">'bold'</span>)
plt.xlabel(<span class="string">'متراژ (مترمربع)'</span>)
plt.ylabel(<span class="string">'قیمت (میلیون تومان)'</span>)

<span class="comment"># خط رگرسیون</span>
<span class="keyword">from</span> scipy <span class="keyword">import</span> stats
slope, intercept, r_value, p_value, std_err = stats.linregress(df_clean[<span class="string">'area'</span>], df_clean[<span class="string">'price'</span>])
line = slope * df_clean[<span class="string">'area'</span>] + intercept
plt.plot(df_clean[<span class="string">'area'</span>], line, <span class="string">'r--'</span>, alpha=<span class="number">0.8</span>, 
         label=<span class="string">f'R² = {r_value**2:.3f}'</span>)
plt.legend()

<span class="comment"># 4. توزیع سن ساختمان</span>
plt.subplot(<span class="number">4</span>, <span class="number">4</span>, <span class="number">4</span>)
age_counts = df_clean[<span class="string">'age_category'</span>].value_counts()
colors = [<span class="string">'#2ecc71'</span>, <span class="string">'#3498db'</span>, <span class="string">'#f39c12'</span>, <span class="string">'#e74c3c'</span>]
plt.pie(age_counts.values, labels=age_counts.index, autopct=<span class="string">'%1.1f%%'</span>, 
        colors=colors, startangle=<span class="number">90</span>)
plt.title(<span class="string">'توزیع سن ساختمان‌ها'</span>, fontweight=<span class="string">'bold'</span>)

<span class="comment"># 5. boxplot قیمت بر اساس تعداد اتاق</span>
plt.subplot(<span class="number">4</span>, <span class="number">4</span>, <span class="number">5</span>)
sns.boxplot(data=df_clean, x=<span class="string">'rooms'</span>, y=<span class="string">'price'</span>)
plt.title(<span class="string">'توزیع قیمت بر اساس تعداد اتاق'</span>, fontweight=<span class="string">'bold'</span>)
plt.xlabel(<span class="string">'تعداد اتاق'</span>)
plt.ylabel(<span class="string">'قیمت (میلیون تومان)'</span>)

<span class="comment"># 6. تأثیر امکانات بر قیمت</span>
plt.subplot(<span class="number">4</span>, <span class="number">4</span>, <span class="number">6</span>)
facilities = [<span class="string">'has_parking'</span>, <span class="string">'has_warehouse'</span>, <span class="string">'has_elevator'</span>]
facility_names = [<span class="string">'پارکینگ'</span>, <span class="string">'انباری'</span>, <span class="string">'آسانسور'</span>]
facility_impact = []

<span class="keyword">for</span> facility <span class="keyword">in</span> facilities:
    with_facility = df_clean[df_clean[facility] == <span class="number">1</span>][<span class="string">'price'</span>].mean()
    without_facility = df_clean[df_clean[facility] == <span class="number">0</span>][<span class="string">'price'</span>].mean()
    impact = ((with_facility - without_facility) / without_facility) * <span class="number">100</span>
    facility_impact.append(impact)

bars = plt.bar(facility_names, facility_impact, 
               color=[<span class="string">'#3498db'</span>, <span class="string">'#2ecc71'</span>, <span class="string">'#f39c12'</span>])
plt.title(<span class="string">'تأثیر امکانات بر قیمت (%)'</span>, fontweight=<span class="string">'bold'</span>)
plt.ylabel(<span class="string">'افزایش قیمت (%)'</span>)
plt.xticks(rotation=<span class="number">45</span>)

<span class="keyword">for</span> bar, impact <span class="keyword">in</span> <span class="function">zip</span>(bars, facility_impact):
    plt.text(bar.get_x() + bar.get_width()/<span class="number">2</span>, bar.get_height() + <span class="number">0.5</span>, 
             <span class="string">f'{impact:.1f}%'</span>, ha=<span class="string">'center'</span>, va=<span class="string">'bottom'</span>, fontweight=<span class="string">'bold'</span>)

<span class="comment"># 7. هیت مپ همبستگی</span>
plt.subplot(<span class="number">4</span>, <span class="number">4</span>, <span class="number">7</span>)
numeric_cols = [<span class="string">'area'</span>, <span class="string">'rooms'</span>, <span class="string">'age'</span>, <span class="string">'floor'</span>, <span class="string">'distance_to_center'</span>, 
                <span class="string">'metro_distance'</span>, <span class="string">'school_rating'</span>, <span class="string">'price'</span>]
correlation_matrix = df_clean[numeric_cols].corr()
sns.heatmap(correlation_matrix, annot=<span class="keyword">True</span>, cmap=<span class="string">'RdYlBu_r'</span>, center=<span class="number">0</span>, 
            square=<span class="keyword">True</span>, fmt=<span class="string">'.2f'</span>)
plt.title(<span class="string">'ماتریس همبستگی'</span>, fontweight=<span class="string">'bold'</span>)

<span class="comment"># 8. قیمت بر اساس جهت ساختمان</span>
plt.subplot(<span class="number">4</span>, <span class="number">4</span>, <span class="number">8</span>)
direction_prices = df_clean.groupby(<span class="string">'direction'</span>)[<span class="string">'price'</span>].mean().sort_values(ascending=<span class="keyword">True</span>)
plt.barh(<span class="function">range</span>(<span class="function">len</span>(direction_prices)), direction_prices.values, 
         color=plt.cm.Pastel1(np.arange(<span class="function">len</span>(direction_prices))))
plt.yticks(<span class="function">range</span>(<span class="function">len</span>(direction_prices)), direction_prices.index)
plt.title(<span class="string">'میانگین قیمت بر اساس جهت'</span>, fontweight=<span class="string">'bold'</span>)
plt.xlabel(<span class="string">'میانگین ق
    یمت (میلیون تومان)'</span>)

<span class="comment"># 9. توزیع قیمت هر متر بر اساس منطقه</span>
plt.subplot(<span class="number">4</span>, <span class="number">4</span>, <span class="number">9</span>)
sns.violinplot(data=df_clean, x=<span class="string">'district'</span>, y=<span class="string">'price_per_sqm'</span>)
plt.title(<span class="string">'توزیع قیمت هر متر بر اساس منطقه'</span>, fontweight=<span class="string">'bold'</span>)
plt.xticks(rotation=<span class="number">45</span>)
plt.ylabel(<span class="string">'قیمت هر متر (میلیون تومان)'</span>)

<span class="comment"># 10. رابطه فاصله از مرکز و قیمت</span>
plt.subplot(<span class="number">4</span>, <span class="number">4</span>, <span class="number">10</span>)
plt.scatter(df_clean[<span class="string">'distance_to_center'</span>], df_clean[<span class="string">'price'</span>], 
           alpha=<span class="number">0.5</span>, c=<span class="string">'coral'</span>)
plt.title(<span class="string">'رابطه فاصله از مرکز و قیمت'</span>, fontweight=<span class="string">'bold'</span>)
plt.xlabel(<span class="string">'فاصله از مرکز (کیلومتر)'</span>)
plt.ylabel(<span class="string">'قیمت (میلیون تومان)'</span>)

<span class="comment"># خط رگرسیون</span>
slope, intercept, r_value, p_value, std_err = stats.linregress(
    df_clean[<span class="string">'distance_to_center'</span>], df_clean[<span class="string">'price'</span>])
line = slope * df_clean[<span class="string">'distance_to_center'</span>] + intercept
plt.plot(df_clean[<span class="string">'distance_to_center'</span>], line, <span class="string">'r--'</span>, alpha=<span class="number">0.8</span>, 
         label=<span class="string">f'R² = {r_value**2:.3f}'</span>)
plt.legend()

<span class="comment"># 11. توزیع املاک بر اساس فصل فروش</span>
plt.subplot(<span class="number">4</span>, <span class="number">4</span>, <span class="number">11</span>)
season_counts = df_clean[<span class="string">'sale_season'</span>].value_counts()
plt.bar(season_counts.index, season_counts.values, 
        color=[<span class="string">'#2ecc71'</span>, <span class="string">'#f39c12'</span>, <span class="string">'#e74c3c'</span>, <span class="string">'#3498db'</span>])
plt.title(<span class="string">'توزیع فروش بر اساس فصل'</span>, fontweight=<span class="string">'bold'</span>)
plt.ylabel(<span class="string">'تعداد فروش'</span>)

<span class="keyword">for</span> i, v <span class="keyword">in</span> <span class="function">enumerate</span>(season_counts.values):
    plt.text(i, v + <span class="number">10</span>, <span class="function">str</span>(v), ha=<span class="string">'center'</span>, va=<span class="string">'bottom'</span>, fontweight=<span class="string">'bold'</span>)

<span class="comment"># 12. امتیاز موقعیت و قیمت</span>
plt.subplot(<span class="number">4</span>, <span class="number">4</span>, <span class="number">12</span>)
plt.scatter(df_clean[<span class="string">'location_score'</span>], df_clean[<span class="string">'price'</span>], 
           alpha=<span class="number">0.6</span>, c=<span class="string">'purple'</span>)
plt.title(<span class="string">'رابطه امتیاز موقعیت و قیمت'</span>, fontweight=<span class="string">'bold'</span>)
plt.xlabel(<span class="string">'امتیاز موقعیت'</span>)
plt.ylabel(<span class="string">'قیمت (میلیون تومان)'</span>)

<span class="comment"># خط رگرسیون</span>
slope, intercept, r_value, p_value, std_err = stats.linregress(
    df_clean[<span class="string">'location_score'</span>], df_clean[<span class="string">'price'</span>])
line = slope * df_clean[<span class="string">'location_score'</span>] + intercept
plt.plot(df_clean[<span class="string">'location_score'</span>], line, <span class="string">'r--'</span>, alpha=<span class="number">0.8</span>, 
         label=<span class="string">f'R² = {r_value**2:.3f}'</span>)
plt.legend()

<span class="comment"># 13. توزیع طبقات</span>
plt.subplot(<span class="number">4</span>, <span class="number">4</span>, <span class="number">13</span>)
plt.hist(df_clean[<span class="string">'floor'</span>], bins=<span class="number">15</span>, alpha=<span class="number">0.7</span>, color=<span class="string">'lightgreen'</span>, edgecolor=<span class="string">'black'</span>)
plt.title(<span class="string">'توزیع طبقات'</span>, fontweight=<span class="string">'bold'</span>)
plt.xlabel(<span class="string">'طبقه'</span>)
plt.ylabel(<span class="string">'فراوانی'</span>)
plt.grid(<span class="keyword">True</span>, alpha=<span class="number">0.3</span>)

<span class="comment"># 14. مقایسه انواع املاک</span>
plt.subplot(<span class="number">4</span>, <span class="number">4</span>, <span class="number">14</span>)
property_prices = df_clean.groupby(<span class="string">'property_type'</span>)[<span class="string">'price'</span>].mean()
plt.bar(property_prices.index, property_prices.values, 
        color=[<span class="string">'#3498db'</span>, <span class="string">'#2ecc71'</span>, <span class="string">'#f39c12'</span>])
plt.title(<span class="string">'میانگین قیمت بر اساس نوع ملک'</span>, fontweight=<span class="string">'bold'</span>)
plt.ylabel(<span class="string">'میانگین قیمت (میلیون تومان)'</span>)

<span class="keyword">for</span> i, v <span class="keyword">in</span> <span class="function">enumerate</span>(property_prices.values):
    plt.text(i, v + <span class="number">200</span>, <span class="string">f'{v:,.0f}'</span>, ha=<span class="string">'center'</span>, va=<span class="string">'bottom'</span>, fontweight=<span class="string">'bold'</span>)

<span class="comment"># 15. امتیاز ساختمان و قیمت</span>
plt.subplot(<span class="number">4</span>, <span class="number">4</span>, <span class="number">15</span>)
plt.scatter(df_clean[<span class="string">'building_score'</span>], df_clean[<span class="string">'price'</span>], 
           alpha=<span class="number">0.6</span>, c=<span class="string">'orange'</span>)
plt.title(<span class="string">'رابطه امتیاز ساختمان و قیمت'</span>, fontweight=<span class="string">'bold'</span>)
plt.xlabel(<span class="string">'امتیاز ساختمان'</span>)
plt.ylabel(<span class="string">'قیمت (میلیون تومان)'</span>)

<span class="comment"># 16. توزیع فاصله تا متro</span>
plt.subplot(<span class="number">4</span>, <span class="number">4</span>, <span class="number">16</span>)
plt.hist(df_clean[<span class="string">'metro_distance'</span>], bins=<span class="number">30</span>, alpha=<span class="number">0.7</span>, color=<span class="string">'lightcoral'</span>, edgecolor=<span class="string">'black'</span>)
plt.axvline(df_clean[<span class="string">'metro_distance'</span>].mean(), color=<span class="string">'red'</span>, linestyle=<span class="string">'--'</span>, 
           label=<span class="string">f'میانگین: {df_clean["metro_distance"].mean():.1f}km'</span>)
plt.title(<span class="string">'توزیع فاصله تا مترو'</span>, fontweight=<span class="string">'bold'</span>)
plt.xlabel(<span class="string">'فاصله تا مترو (کیلومتر)'</span>)
plt.ylabel(<span class="string">'فراوانی'</span>)
plt.legend()
plt.grid(<span class="keyword">True</span>, alpha=<span class="number">0.3</span>)

plt.suptitle(<span class="string">'داشبورد جامع تحلیل اکتشافی داده‌های املاک'</span>, fontsize=<span class="number">20</span>, fontweight=<span class="string">'bold'</span>)
plt.tight_layout()
plt.show()

<span class="function">print</span>(<span class="string">"✅ داشبورد EDA تولید شد"</span>)
                    </div>

                    <h3>🔍 تحلیل آماری پیشرفته</h3>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">کپی</button>
<span class="comment"># تحلیل آماری پیشرفته</span>
<span class="function">print</span>(<span class="string">f"\n🔍 تحلیل آماری پیشرفته:"</span>)
<span class="function">print</span>(<span class="string">"="</span> * <span class="number">35</span>)

<span class="keyword">from</span> scipy <span class="keyword">import</span> stats
<span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> StandardScaler

<span class="comment"># 1. آزمون نرمال بودن قیمت</span>
<span class="function">print</span>(<span class="string">"📊 آزمون نرمال بودن قیمت:"</span>)
shapiro_stat, shapiro_p = stats.shapiro(df_clean[<span class="string">'price'</span>].sample(<span class="number">5000</span>))  <span class="comment"># نمونه برای سرعت</span>
<span class="function">print</span>(<span class="string">f"Shapiro-Wilk Test: statistic={shapiro_stat:.4f}, p-value={shapiro_p:.4f}"</span>)

<span class="keyword">if</span> shapiro_p > <span class="number">0.05</span>:
    <span class="function">print</span>(<span class="string">"✅ توزیع قیمت نرمال است"</span>)
<span class="keyword">else</span>:
    <span class="function">print</span>(<span class="string">"⚠️ توزیع قیمت نرمال نیست - نیاز به تبدیل"</span>)

<span class="comment"># 2. آزمون ANOVA برای تفاوت قیمت بین مناطق</span>
<span class="function">print</span>(<span class="string">f"\n📈 آزمون ANOVA برای مناطق:"</span>)
district_groups = [df_clean[df_clean[<span class="string">'district'</span>] == district][<span class="string">'price'</span>] 
                  <span class="keyword">for</span> district <span class="keyword">in</span> df_clean[<span class="string">'district'</span>].unique()]

f_stat, f_p = stats.f_oneway(*district_groups)
<span class="function">print</span>(<span class="string">f"F-statistic: {f_stat:.4f}, p-value: {f_p:.4f}"</span>)

<span class="keyword">if</span> f_p < <span class="number">0.05</span>:
    <span class="function">print</span>(<span class="string">"✅ تفاوت معنی‌داری بین قیمت مناطق وجود دارد"</span>)
<span class="keyword">else</span>:
    <span class="function">print</span>(<span class="string">"❌ تفاوت معنی‌داری بین قیمت مناطق وجود ندارد"</span>)

<span class="comment"># 3. ضریب همبستگی ویژگی‌ها با قیمت</span>
<span class="function">print</span>(<span class="string">f"\n🔗 همبستگی ویژگی‌ها با قیمت:"</span>)
numeric_features = [<span class="string">'area'</span>, <span class="string">'rooms'</span>, <span class="string">'age'</span>, <span class="string">'floor'</span>, <span class="string">'total_floors'</span>,
                   <span class="string">'distance_to_center'</span>, <span class="string">'metro_distance'</span>, <span class="string">'school_rating'</span>,
                   <span class="string">'location_score'</span>, <span class="string">'building_score'</span>, <span class="string">'price_per_sqm'</span>]

correlations = []
<span class="keyword">for</span> feature <span class="keyword">in</span> numeric_features:
    corr, p_val = stats.pearsonr(df_clean[feature], df_clean[<span class="string">'price'</span>])
    correlations.append((feature, corr, p_val))

correlations.sort(key=<span class="keyword">lambda</span> x: <span class="function">abs</span>(x[<span class="number">1</span>]), reverse=<span class="keyword">True</span>)

<span class="function">print</span>(<span class="string">"ویژگی‌ها به ترتیب اهمیت همبستگی:"</span>)
<span class="keyword">for</span> feature, corr, p_val <span class="keyword">in</span> correlations:
    significance = <span class="string">"***"</span> <span class="keyword">if</span> p_val < <span class="number">0.001</span> <span class="keyword">else</span> <span class="string">"**"</span> <span class="keyword">if</span> p_val < <span class="number">0.01</span> <span class="keyword">else</span> <span class="string">"*"</span> <span class="keyword">if</span> p_val < <span class="number">0.05</span> <span class="keyword">else</span> <span class="string">""</span>
    <span class="function">print</span>(<span class="string">f"  {feature:<20}: {corr:>7.3f} {significance}"</span>)

<span class="comment"># 4. تحلیل variance inflation factor (VIF)</span>
<span class="function">print</span>(<span class="string">f"\n📐 تحلیل VIF (هم‌خطی):"</span>)
<span class="keyword">from</span> statsmodels.stats.outliers_influence <span class="keyword">import</span> variance_inflation_factor

<span class="comment"># انتخاب ویژگی‌های عددی مهم</span>
vif_features = [<span class="string">'area'</span>, <span class="string">'rooms'</span>, <span class="string">'age'</span>, <span class="string">'floor'</span>, <span class="string">'distance_to_center'</span>, 
               <span class="string">'metro_distance'</span>, <span class="string">'school_rating'</span>, <span class="string">'location_score'</span>, <span class="string">'building_score'</span>]

vif_data = df_clean[vif_features].dropna()
scaler = StandardScaler()
vif_scaled = scaler.fit_transform(vif_data)

<span class="function">print</span>(<span class="string">"VIF Score (>10 نشانه هم‌خطی قوی):"</span>)
<span class="keyword">for</span> i, feature <span class="keyword">in</span> <span class="function">enumerate</span>(vif_features):
    vif_score = variance_inflation_factor(vif_scaled, i)
    status = <span class="string">"⚠️ بالا"</span> <span class="keyword">if</span> vif_score > <span class="number">10</span> <span class="keyword">else</span> <span class="string">"⚡ متوسط"</span> <span class="keyword">if</span> vif_score > <span class="number">5</span> <span class="keyword">else</span> <span class="string">"✅ پایین"</span>
    <span class="function">print</span>(<span class="string">f"  {feature:<20}: {vif_score:>7.2f} {status}"</span>)

<span class="comment"># 5. تحلیل اهمیت ویژگی‌های دسته‌ای</span>
<span class="function">print</span>(<span class="string">f"\n🏷️ تحلیل ویژگی‌های دسته‌ای:"</span>)

categorical_features = [<span class="string">'district'</span>, <span class="string">'direction'</span>, <span class="string">'property_type'</span>, <span class="string">'age_category'</span>, <span class="string">'sale_season'</span>]

<span class="keyword">for</span> feature <span class="keyword">in</span> categorical_features:
    <span class="comment"># محاسبه eta squared (effect size)</span>
    groups = [df_clean[df_clean[feature] == cat][<span class="string">'price'</span>] <span class="keyword">for</span> cat <span class="keyword">in</span> df_clean[feature].unique()]
    f_stat, p_val = stats.f_oneway(*groups)
    
    <span class="comment"># محاسبه eta squared</span>
    ss_between = <span class="function">sum</span>([<span class="function">len</span>(group) * (group.mean() - df_clean[<span class="string">'price'</span>].mean())**<span class="number">2</span> <span class="keyword">for</span> group <span class="keyword">in</span> groups])
    ss_total = <span class="function">sum</span>([(df_clean[<span class="string">'price'</span>] - df_clean[<span class="string">'price'</span>].mean())**<span class="number">2</span>])
    eta_squared = ss_between / ss_total
    
    significance = <span class="string">"***"</span> <span class="keyword">if</span> p_val < <span class="number">0.001</span> <span class="keyword">else</span> <span class="string">"**"</span> <span class="keyword">if</span> p_val < <span class="number">0.01</span> <span class="keyword">else</span> <span class="string">"*"</span> <span class="keyword">if</span> p_val < <span class="number">0.05</span> <span class="keyword">else</span> <span class="string">""</span>
    effect_size = <span class="string">"بزرگ"</span> <span class="keyword">if</span> eta_squared > <span class="number">0.14</span> <span class="keyword">else</span> <span class="string">"متوسط"</span> <span class="keyword">if</span> eta_squared > <span class="number">0.06</span> <span class="keyword">else</span> <span class="string">"کوچک"</span>
    
    <span class="function">print</span>(<span class="string">f"  {feature:<15}: η²={eta_squared:.3f} ({effect_size}) {significance}"</span>)

<span class="comment"># 6. خلاصه نتایج تحلیل</span>
<span class="function">print</span>(<span class="string">f"\n📋 خلاصه نتایج تحلیل:"</span>)
<span class="function">print</span>(<span class="string">"="</span> * <span class="number">40</span>)

top_correlations = [item <span class="keyword">for</span> item <span class="keyword">in</span> correlations[:<span class="number">5</span>]]
<span class="function">print</span>(<span class="string">"🏆 مؤثرترین ویژگی‌های عددی:"</span>)
<span class="keyword">for</span> i, (feature, corr, p_val) <span class="keyword">in</span> <span class="function">enumerate</span>(top_correlations, <span class="number">1</span>):
    <span class="function">print</span>(<span class="string">f"  {i}. {feature}: {corr:.3f}"</span>)

<span class="function">print</span>(<span class="string">f"\n💡 نکات کلیدی:"</span>)
<span class="function">print</span>(<span class="string">f"  • منطقه قوی‌ترین تأثیر را بر قیمت دارد"</span>)
<span class="function">print</span>(<span class="string">f"  • متراژ و امتیاز موقعیت عوامل مهم هستند"</span>)
<span class="function">print</span>(<span class="string">f"  • سن ساختمان تأثیر منفی بر قیمت دارد"</span>)
<span class="function">print</span>(<span class="string">f"  • فاصله از مرکز و متro مهم است"</span>)
<span class="function">print</span>(<span class="string">f"  • امکانات (پارکینگ، آسانسور) تأثیر مثبت دارند"</span>)

<span class="comment"># محاسبه آمارهای توصیفی گروهی</span>
<span class="function">print</span>(<span class="string">f"\n📊 آمارهای کلیدی:"</span>)
<span class="function">print</span>(<span class="string">f"  • میانگین قیمت کل: {df_clean['price'].mean():,.0f} میلیون تومان"</span>)
<span class="function">print</span>(<span class="string">f"  • انحراف معیار قیمت: {df_clean['price'].std():,.0f} میلیون تومان"</span>)
<span class="function">print</span>(<span class="string">f"  • ضریب تغییرات: {(df_clean['price'].std()/df_clean['price'].mean())*100:.1f}%"</span>)
<span class="function">print</span>(<span class="string">f"  • دامنه قیمت: {df_clean['price'].min():,.0f} - {df_clean['price'].max():,.0f}"</span>)
<span class="function">print</span>(<span class="string">f"  • میانه قیمت: {df_clean['price'].median():,.0f} میلیون تومان"</span>)

<span class="function">print</span>(<span class="string">"✅ تحلیل آماری تکمیل شد"</span>)
                    </div>

                    <div class="challenge-box">
                        <div class="challenge-title">🎯 نتایج کلیدی تحلیل اکتشافی</div>
                        <p>تحلیل EDA نشان داد که:</p>
                        <ul>
                            <li>✅ منطقه مهم‌ترین عامل تعیین‌کننده قیمت است</li>
                            <li>✅ رابطه مثبت قوی بین متراژ و قیمت وجود دارد</li>
                            <li>✅ امکانات ساختمان تأثیر معنی‌داری بر قیمت دارند</li>
                            <li>✅ فاصله از مرکز و مترو عوامل مهم موقعیتی هستند</li>
                            <li>✅ سن ساختمان رابطه منفی با قیمت دارد</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- اسلاید 4: مدل‌سازی پیشرفته -->
            <div class="slide" id="slide4">
                <div class="slide-number">4/15</div>
                <button class="expand-btn" onclick="expandSlide(this)">🔍</button>
                <button class="close-btn" onclick="closeSlide(this)">×</button>
                <div class="icon">🤖</div>
                <div class="slide-title">مدل‌سازی و یادگیری ماشین پیشرفته</div>
                <div class="slide-content">
                    <h3>🚀 آموزش مدل‌های مختلف و انتخاب بهترین</h3>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">کپی</button>
<span class="comment"># مدل‌سازی پیشرفته برای پیش‌بینی قیمت مسکن</span>
<span class="function">print</span>(<span class="string">f"\n🤖 مدل‌سازی پیشرفته:"</span>)
<span class="function">print</span>(<span class="string">"="</span> * <span class="number">35</span>)

<span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split, cross_val_score, GridSearchCV
<span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> StandardScaler, LabelEncoder, OneHotEncoder
<span class="keyword">from</span> sklearn.compose <span class="keyword">import</span> ColumnTransformer
<span class="keyword">from</span> sklearn.pipeline <span class="keyword">import</span> Pipeline
<span class="keyword">from</span> sklearn.ensemble <span class="keyword">import</span> RandomForestRegressor, GradientBoostingRegressor
<span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> LinearRegression, Ridge, Lasso, ElasticNet
<span class="keyword">from</span> sklearn.svm <span class="keyword">import</span> SVR
<span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> mean_squared_error, mean_absolute_error, r2_score
<span class="keyword">import</span> xgboost <span class="keyword">as</span> xgb
<span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> RandomizedSearchCV
<span class="keyword">import</span> joblib
<span class="keyword">import</span> time

<span class="comment"># تعریف ویژگی‌ها</span>
<span class="function">print</span>(<span class="string">"🎯 آماده‌سازی ویژگی‌ها..."</span>)

<span class="comment"># ویژگی‌های عددی</span>
numeric_features = [
    <span class="string">'area'</span>, <span class="string">'rooms'</span>, <span class="string">'age'</span>, <span class="string">'floor'</span>, <span class="string">'total_floors'</span>,
    <span class="string">'distance_to_center'</span>, <span class="string">'metro_distance'</span>, <span class="string">'school_rating'</span>,
    <span class="string">'has_parking'</span>, <span class="string">'has_warehouse'</span>, <span class="string">'has_elevator'</span>,
    <span class="string">'location_score'</span>, <span class="string">'building_score'</span>, <span class="string">'floor_ratio'</span>, <span class="string">'sale_month'</span>
]

<span class="comment"># ویژگی‌های دسته‌ای</span>
categorical_features = [<span class="string">'district'</span>, <span class="string">'direction'</span>, <span class="string">'property_type'</span>, <span class="string">'age_category'</span>, <span class="string">'area_category'</span>, <span class="string">'sale_season'</span>]

<span class="comment"># آماده‌سازی داده‌ها</span>
X = df_clean[numeric_features + categorical_features].copy()
y = df_clean[<span class="string">'price'</span>].copy()

<span class="function">print</span>(<span class="string">f"تعداد ویژگی‌های عددی: {len(numeric_features)}"</span>)
<span class="function">print</span>(<span class="string">f"تعداد ویژگی‌های دسته‌ای: {len(categorical_features)}"</span>)
<span class="function">print</span>(<span class="string">f"شکل داده‌ها: {X.shape}"</span>)

<span class="comment"># تقسیم داده‌ها</span>
X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=<span class="number">0.2</span>, random_state=<span class="number">42</span>, stratify=pd.cut(y, bins=<span class="number">5</span>)
)

<span class="comment"># تقسیم validation set</span>
X_train, X_val, y_train, y_val = train_test_split(
    X_train, y_train, test_size=<span class="number">0.2</span>, random_state=<span class="number">42</span>
)

<span class="function">print</span>(<span class="string">f"داده‌های آموزش: {X_train.shape[0]:,}"</span>)
<span class="function">print</span>(<span class="string">f"داده‌های validation: {X_val.shape[0]:,}"</span>)
<span class="function">print</span>(<span class="string">f"داده‌های تست: {X_test.shape[0]:,}"</span>)

<span class="comment"># ایجاد preprocessor</span>
<span class="function">print</span>(<span class="string">f"\n🔧 ایجاد pipeline پردازش..."</span>)

<span class="comment"># پردازش‌کننده ویژگی‌های عددی</span>
numeric_transformer = StandardScaler()

<span class="comment"># پردازش‌کننده ویژگی‌های دسته‌ای</span>
categorical_transformer = OneHotEncoder(drop=<span class="string">'first'</span>, sparse_output=<span class="keyword">False</span>)

<span class="comment"># ترکیب پردازش‌کننده‌ها</span>
preprocessor = ColumnTransformer(
    transformers=[
        (<span class="string">'num'</span>, numeric_transformer, numeric_features),
        (<span class="string">'cat'</span>, categorical_transformer, categorical_features)
    ]
)

<span class="comment"># تعریف مدل‌ها</span>
<span class="function">print</span>(<span class="string">f"\n🎯 تعریف مدل‌های مختلف..."</span>)

models = {
    <span class="string">'Linear Regression'</span>: LinearRegression(),
    <span class="string">'Ridge'</span>: Ridge(random_state=<span class="number">42</span>),
    <span class="string">'Lasso'</span>: Lasso(random_state=<span class="number">42</span>),
    <span class="string">'ElasticNet'</span>: ElasticNet(random_state=<span class="number">42</span>),
    <span class="string">'Random Forest'</span>: RandomForestRegressor(n_estimators=<span class="number">100</span>, random_state=<span class="number">42</span>, n_jobs=-<span class="number">1</span>),
    <span class="string">'Gradient Boosting'</span>: GradientBoostingRegressor(random_state=<span class="number">42</span>),
    <span class="string">'XGBoost'</span>: xgb.XGBRegressor(random_state=<span class="number">42</span>, eval_metric=<span class="string">'rmse'</span>)
}

<span class="comment"># آموزش و ارزیابی مدل‌ها</span>
<span class="function">print</span>(<span class="string">f"\n🚀 آموزش مدل‌ها..."</span>)

results = {}
training_times = {}

<span class="keyword">for</span> name, model <span class="keyword">in</span> models.items():
    <span class="function">print</span>(<span class="string">f"\n📊 آموزش {name}..."</span>)
    
    <span class="comment"># ایجاد pipeline</span>
    pipeline = Pipeline([
        (<span class="string">'preprocessor'</span>, preprocessor),
        (<span class="string">'regressor'</span>, model)
    ])
    
    <span class="comment"># اندازه‌گیری زمان آموزش</span>
    start_time = time.time()
    
    <span class="comment"># آموزش مدل</span>
    pipeline.fit(X_train, y_train)
    
    training_time = time.time() - start_time
    training_times[name] = training_time
    
    <span class="comment"># پیش‌بینی</span>
    y_train_pred = pipeline.predict(X_train)
    y_val_pred = pipeline.predict(X_val)
    y_test_pred = pipeline.predict(X_test)
    
    <span class="comment"># محاسبه معیارها</span>
    train_rmse = np.sqrt(mean_squared_error(y_train, y_train_pred))
    val_rmse = np.sqrt(mean_squared_error(y_val, y_val_pred))
    test_rmse = np.sqrt(mean_squared_error(y_test, y_test_pred))
    
    train_mae = mean_absolute_error(y_train, y_train_pred)
    val_mae = mean_absolute_error(y_val, y_val_pred)
    test_mae = mean_absolute_error(y_test, y_test_pred)
    
    train_r2 = r2_score(y_train, y_train_pred)
    val_r2 = r2_score(y_val, y_val_pred)
    test_r2 = r2_score(y_test, y_test_pred)
    
    <span class="comment"># محاسبه MAPE</span>
    train_mape = np.mean(np.abs((y_train - y_train_pred) / y_train)) * <span class="number">100</span>
    val_mape = np.mean(np.abs((y_val - y_val_pred) / y_val)) * <span class="number">100</span>
    test_mape = np.mean(np.abs((y_test - y_test_pred) / y_test)) * <span class="number">100</span>
    
    <span class="comment"># ذخیره نتایج</span>
    results[name] = {
        <span class="string">'pipeline'</span>: pipeline,
        <span class="string">'train_rmse'</span>: train_rmse,
        <span class="string">'val_rmse'</span>: val_rmse,
        <span class="string">'test_rmse'</span>: test_rmse,
        <span class="string">'train_mae'</span>: train_mae,
        <span class="string">'val_mae'</span>: val_mae,
        <span class="string">'test_mae'</span>: test_mae,
        <span class="string">'train_r2'</span>: train_r2,
        <span class="string">'val_r2'</span>: val_r2,
        <span class="string">'test_r2'</span>: test_r2,
        <span class="string">'train_mape'</span>: train_mape,
        <span class="string">'val_mape'</span>: val_mape,
        <span class="string">'test_mape'</span>: test_mape,
        <span class="string">'training_time'</span>: training_time
    }
    
    <span class="function">print</span>(<span class="string">f"  ✅ Train R²: {train_r2:.4f}, Val R²: {val_r2:.4f}, Test R²: {test_r2:.4f}"</span>)
    <span class="function">print</span>(<span class="string">f"     Val RMSE: {val_rmse:.0f}, Test RMSE: {test_rmse:.0f}"</span>)
    <span class="function">print</span>(<span class="string">f"     زمان آموزش: {training_time:.2f} ثانیه"</span>)

<span class="comment"># یافتن بهترین مدل بر اساس validation R²</span>
best_model_name = <span class="function">max</span>(results, key=<span class="keyword">lambda</span> x: results[x][<span class="string">'val_r2'</span>])
best_model = results[best_model_name][<span class="string">'pipeline'</span>]

<span class="function">print</span>(<span class="string">f"\n🏆 بهترین مدل: {best_model_name}"</span>)
<span class="function">print</span>(<span class="string">f"Validation R²: {results[best_model_name]['val_r2']:.4f}"</span>)
<span class="function">print</span>(<span class="string">f"Test R²: {results[best_model_name]['test_r2']:.4f}"</span>)
<span class="function">print</span>(<span class="string">f"Test RMSE: {results[best_model_name]['test_rmse']:.0f} میلیون تومان"</span>)
<span class="function">print</span>(<span class="string">f"Test MAE: {results[best_model_name]['test_mae']:.0f} میلیون تومان"</span>)
<span class="function">print</span>(<span class="string">f"Test MAPE: {results[best_model_name]['test_mape']:.1f}%"</span>)
                    </div>

                    <h3>⚡ بهینه‌سازی هایپرپارامترها</h3>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">کپی</button>
<span class="comment"># بهینه‌سازی هایپرپارامترهای بهترین مدل‌ها</span>
<span class="function">print</span>(<span class="string">f"\n⚡ بهینه‌سازی هایپرپارامترها:"</span>)
<span class="function">print</span>(<span class="string">"="</span> * <span class="number">40</span>)

<span class="comment"># انتخاب 3 مدل برتر برای بهینه‌سازی</span>
top_models = <span class="function">sorted</span>(results.items(), key=<span class="keyword">lambda</span> x: x[<span class="number">1</span>][<span class="string">'val_r2'</span>], reverse=<span class="keyword">True</span>)[:<span class="number">3</span>]
<span class="function">print</span>(<span class="string">"🎯 مدل‌های انتخابی برای بهینه‌سازی:"</span>)
<span class="keyword">for</span> i, (name, metrics) <span class="keyword">in</span> <span class="function">enumerate</span>(top_models, <span class="number">1</span>):
    <span class="function">print</span>(<span class="string">f"  {i}. {name}: R² = {metrics['val_r2']:.4f}"</span>)

<span class="comment"># تعریف فضای جستجو برای هر مدل</span>
param_grids = {
    <span class="string">'Random Forest'</span>: {
        <span class="string">'regressor__n_estimators'</span>: [<span class="number">100</span>, <span class="number">200</span>, <span class="number">300</span>],
        <span class="string">'regressor__max_depth'</span>: [<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="keyword">None</span>],
        <span class="string">'regressor__min_samples_split'</span>: [<span class="number">2</span>, <span class="number">5</span>, <span class="number">10</span>],
        <span class="string">'regressor__min_samples_leaf'</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>],
        <span class="string">'regressor__max_features'</span>: [<span class="string">'sqrt'</span>, <span class="string">'log2'</span>, <span class="keyword">None</span>]
    },
    <span class="string">'XGBoost'</span>: {
        <span class="string">'regressor__n_estimators'</span>: [<span class="number">100</span>, <span class="number">200</span>, <span class="number">300</span>],
        <span class="string">'regressor__max_depth'</span>: [<span class="number">3</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">12</span>],
        <span class="string">'regressor__learning_rate'</span>: [<span class="number">0.01</span>, <span class="number">0.1</span>, <span class="number">0.2</span>],
        <span class="string">'regressor__subsample'</span>: [<span class="number">0.8</span>, <span class="number">0.9</span>, <span class="number">1.0</span>],
        <span class="string">'regressor__colsample_bytree'</span>: [<span class="number">0.8</span>, <span class="number">0.9</span>, <span class="number">1.0</span>]
    },
    <span class="string">'Gradient Boosting'</span>: {
        <span class="string">'regressor__n_estimators'</span>: [<span class="number">100</span>, <span class="number">200</span>, <span class="number">300</span>],
        <span class="string">'regressor__max_depth'</span>: [<span class="number">3</span>, <span class="number">6</span>, <span class="number">9</span>],
        <span class="string">'regressor__learning_rate'</span>: [<span class="number">0.01</span>, <span class="number">0.1</span>, <span class="number">0.2</span>],
        <span class="string">'regressor__subsample'</span>: [<span class="number">0.8</span>, <span class="number">0.9</span>, <span class="number">1.0</span>]
    }
}

optimized_models = {}

<span class="keyword">for</span> model_name, _ <span class="keyword">in</span> top_models:
    <span class="keyword">if</span> model_name <span class="keyword">in</span> param_grids:
        <span class="function">print</span>(<span class="string">f"\n🔍 بهینه‌سازی {model_name}..."</span>)
        
        <span class="comment"># ایجاد pipeline جدید</span>
        <span class="keyword">if</span> model_name == <span class="string">'Random Forest'</span>:
            model = RandomForestRegressor(random_state=<span class="number">42</span>, n_jobs=-<span class="number">1</span>)
        <span class="keyword">elif</span> model_name == <span class="string">'XGBoost'</span>:
            model = xgb.XGBRegressor(random_state=<span class="number">42</span>, eval_metric=<span class="string">'rmse'</span>)
        <span class="keyword">elif</span> model_name == <span class="string">'Gradient Boosting'</span>:
            model = GradientBoostingRegressor(random_state=<span class="number">42</span>)
        
        pipeline = Pipeline([
            (<span class="string">'preprocessor'</span>, preprocessor),
            (<span class="string">'regressor'</span>, model)
        ])
        
        <span class="comment"># استفاده از RandomizedSearchCV برای سرعت بیشتر</span>
        random_search = RandomizedSearchCV(
            pipeline,
            param_grids[model_name],
            n_iter=<span class="number">50</span>,  <span class="comment"># تعداد کمتر برای سرعت</span>
            cv=<span class="number">3</span>,
            scoring=<span class="string">'r2'</span>,
            random_state=<span class="number">42</span>,
            n_jobs=-<span class="number">1</span>,
            verbose=<span class="number">1</span>
        )
        
        <span class="comment"># آموزش</span>
        start_time = time.time()
        random_search.fit(X_train, y_train)
        optimization_time = time.time() - start_time
        
        <span class="comment"># بهترین مدل</span>
        best_pipeline = random_search.best_estimator_
        
        <span class="comment"># ارزیابی</span>
        y_val_pred = best_pipeline.predict(X_val)
        y_test_pred = best_pipeline.predict(X_test)
        
        val_r2 = r2_score(y_val, y_val_pred)
        test_r2 = r2_score(y_test, y_test_pred)
        test_rmse = np.sqrt(mean_squared_error(y_test, y_test_pred))
        test_mae = mean_absolute_error(y_test, y_test_pred)
        test_mape = np.mean(np.abs((y_test - y_test_pred) / y_test)) * <span class="number">100</span>
        
        optimized_models[model_name] = {
            <span class="string">'pipeline'</span>: best_pipeline,
            <span class="string">'best_params'</span>: random_search.best_params_,
            <span class="string">'best_score'</span>: random_search.best_score_,
            <span class="string">'val_r2'</span>: val_r2,
            <span class="string">'test_r2'</span>: test_r2,
            <span class="string">'test_rmse'</span>: test_rmse,
            <span class="string">'test_mae'</span>: test_mae,
            <span class="string">'test_mape'</span>: test_mape,
            <span class="string">'optimization_time'</span>: optimization_time
        }
        
        <span class="function">print</span>(<span class="string">f"  ✅ بهترین CV Score: {random_search.best_score_:.4f}"</span>)
        <span class="function">print</span>(<span class="string">f"     Validation R²: {val_r2:.4f}"</span>)
        <span class="function">print</span>(<span class="string">f"     Test R²: {test_r2:.4f}"</span>)
        <span class="function">print</span>(<span class="string">f"     Test RMSE: {test_rmse:.0f}"</span>)
        <span class="function">print</span>(<span class="string">f"     زمان بهینه‌سازی: {optimization_time:.1f} ثانیه"</span>)
        <span class="function">print</span>(<span class="string">f"     بهترین پارامترها: {random_search.best_params_}"</span>)

<span class="comment"># یافتن بهترین مدل بهینه‌سازی شده</span>
<span class="keyword">if</span> optimized_models:
    best_optimized_name = <span class="function">max</span>(optimized_models, key=<span class="keyword">lambda</span> x: optimized_models[x][<span class="string">'test_r2'</span>])
    best_optimized_model = optimized_models[best_optimized_name]
    
    <span class="function">print</span>(<span class="string">f"\n🏆 بهترین مدل بهینه‌سازی شده: {best_optimized_name}"</span>)
    <span class="function">print</span>(<span class="string">f"Test R²: {best_optimized_model['test_r2']:.4f}"</span>)
    <span class="function">print</span>(<span class="string">f"Test RMSE: {best_optimized_model['test_rmse']:.0f} میلیون تومان"</span>)
    <span class="function">print</span>(<span class="string">f"Test MAE: {best_optimized_model['test_mae']:.0f} میلیون تومان"</span>)
    <span class="function">print</span>(<span class="string">f"Test MAPE: {best_optimized_model['test_mape']:.1f}%"</span>)
    
    <span class="comment"># مقایسه با مدل اولیه</span>
    original_r2 = results[best_optimized_name][<span class="string">'test_r2'</span>]
    improvement = ((best_optimized_model[<span class="string">'test_r2'</span>] - original_r2) / original_r2) * <span class="number">100</span>
    <span class="function">print</span>(<span class="string">f"بهبود نسبت به مدل اولیه: {improvement:.2f}%"</span>)
    
    <span class="comment"># انتخاب مدل نهایی</span>
    final_model = best_optimized_model[<span class="string">'pipeline'</span>]
    final_model_name = best_optimized_name
<span class="keyword">else</span>:
    final_model = best_model
    final_model_name = best_model_name

<span class="function">print</span>(<span class="string">f"\n🎯 مدل نهایی انتخاب شده: {final_model_name}"</span>)
                    </div>

                    <div class="model-comparison">
                        <div class="model-card">
                            <div class="model-name">Linear Regression</div>
                            <div class="model-accuracy">85%</div>
                            <div class="model-desc">سریع و قابل تفسیر</div>
                        </div>
                        <div class="model-card">
                            <div class="model-name">Random Forest</div>
                            <div class="model-accuracy">92%</div>
                            <div class="model-desc">مقاوم و دقیق</div>
                        </div>
                        <div class="model-card">
                            <div class="model-name">XGBoost</div>
                            <div class="model-accuracy">95%</div>
                            <div class="model-desc">بهترین عملکرد</div>
                        </div>
                        <div class="model-card">
                            <div class="model-name">Ensemble</div>
                            <div class="model-accuracy">96%</div>
                            <div class="model-desc">ترکیب مدل‌ها</div>
                        </div>
                    </div>

                    <div class="tip-box">
                        <div class="tip-title">💡 نکات مهم مدل‌سازی</div>
                        <ul>
                            <li><strong>Cross-Validation:</strong> اعتبارسنجی متقابل برای ارزیابی دقیق</li>
                            <li><strong>Feature Engineering:</strong> ایجاد ویژگی‌های مفید</li>
                            <li><strong>Hyperparameter Tuning:</strong> بهینه‌سازی پارامترها</li>
                            <li><strong>Ensemble Methods:</strong> ترکیب مدل‌ها برای بهبود عملکرد</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- ادامه اسلایدها در بخش بعدی... -->
        </div>

        <!-- کنترل‌های ناوبری -->
        <div class="navigation">
            <button class="nav-btn" id="prevBtn" onclick="changeSlide(-1)">❮ قبلی</button>
            <span class="slide-info" id="slideInfo">1 / 15</span>
            <button class="nav-btn" id="nextBtn" onclick="changeSlide(1)">بعدی ❯</button>
        </div>

        <!-- فهرست اسلایدها -->
        <div class="slide-list">
            <h3>📋 فهرست جلسه دوازدهم:</h3>
            <div class="slide-links">
                <a href="#" onclick="goToSlide(1)">1. معرفی پروژه نهایی</a>
                <a href="#" onclick="goToSlide(2)">2. جمع‌آوری و پردازش داده</a>
                <a href="#" onclick="goToSlide(3)">3. تحلیل اکتشافی EDA</a>
                <a href="#" onclick="goToSlide(4)">4. مدل‌سازی پیشرفته</a>
                <a href="#" onclick="goToSlide(5)">5. تحلیل مدل و Feature Importance</a>
                <a href="#" onclick="goToSlide(6)">6. ایجاد API با Flask</a>
                <a href="#" onclick="goToSlide(7)">7. وب اپلیکیشن Streamlit</a>
                <a href="#" onclick="goToSlide(8)">8. Containerization با Docker</a>
                <a href="#" onclick="goToSlide(9)">9. استقرار در Cloud</a>
                <a href="#" onclick="goToSlide(10)">10. مونیتورینگ و MLOps</a>
                <a href="#" onclick="goToSlide(11)">11. CI/CD Pipeline</a>
                <a href="#" onclick="goToSlide(12)">12. تست و Quality Assurance</a>
                <a href="#" onclick="goToSlide(13)">13. بهینه‌سازی عملکرد</a>
                <a href="#" onclick="goToSlide(14)">14. مستندات و نگهداری</a>
                <a href="#" onclick="goToSlide(15)">15. جمع‌بندی و آینده</a>
            </div>
        </div>
    </div>

    <script>
        let currentSlide = 1;
        const totalSlides = 15;

        function showSlide(n) {
            const slides = document.querySelectorAll('.slide');
            
            if (n > totalSlides) currentSlide = 1;
            if (n < 1) currentSlide = totalSlides;
            
            slides.forEach(slide => {
                slide.classList.remove('active');
                slide.style.display = 'none';
            });
            
            const targetSlide = document.getElementById(`slide${currentSlide}`);
            if (targetSlide) {
                targetSlide.classList.add('active');
                targetSlide.style.display = 'block';
            }
            
            document.getElementById('slideInfo').textContent = `${currentSlide} / ${totalSlides}`;
            
            document.getElementById('prevBtn').style.opacity = currentSlide === 1 ? '0.5' : '1';
            document.getElementById('nextBtn').style.opacity = currentSlide === totalSlides ? '0.5' : '1';
        }

        function changeSlide(n) {
            currentSlide += n;
            showSlide(currentSlide);
        }

        function goToSlide(n) {
            currentSlide = n;
            showSlide(currentSlide);
        }

        function expandSlide(btn) {
            const slide = btn.closest('.slide');
            slide.classList.add('expanded');
        }

        function closeSlide(btn) {
            const slide = btn.closest('.slide');
            slide.classList.remove('expanded');
        }

        function copyCode(btn) {
            const codeBlock = btn.nextElementSibling;
            const text = codeBlock.textContent;
            
            navigator.clipboard.writeText(text).then(() => {
                btn.textContent = '✅ کپی شد';
                setTimeout(() => {
                    btn.textContent = 'کپی';
                }, 2000);
            });
        }

        // کلیدهای میانبر
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft') changeSlide(-1);
            if (e.key === 'ArrowRight') changeSlide(1);
            if (e.key === 'Escape') {
                document.querySelectorAll('.slide.expanded').forEach(slide => {
                    slide.classList.remove('expanded');
                });
            }
        });

        // نمایش اولین اسلاید
        showSlide(1);
    </script>
</body>
</html>